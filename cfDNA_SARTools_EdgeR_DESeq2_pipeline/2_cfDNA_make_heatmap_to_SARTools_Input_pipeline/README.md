## Author
Created by **Sakuntha Devaka Gunarathna**  
Published: August 1, 2025

# Heatmap Summary to SARTools (DESeq/EdgeR) Count Matrix (user-defined 1kb Window).

This script converts the output of **deepTools `multiBigwigSummary`** into a tab-delimited count matrix 
that can be used as input for **SARTools DESeq2** or **edgeR**.

## Overview

- The script reads per-sample coverage data generated by deepTools `multiBigwigSummary`.
- It extracts signal counts across a user-defined 1 kb window.
- It compiles results into a single matrix suitable for differential analysis.

---

## Input Requirements

### Step 1: Generate Input Files with deepTools

Run `multiBigwigSummary` on your bigWig files:

```bash
multiBigwigSummary BED-file \
  -b <path_to_bigwig_files_group1>/*.bw <path_to_bigwig_files_group2>/*.bw ... \
  --BED <regions_file>.bed \
  -o results_matrix.npz \
  --outRawCounts results_matrix.tab
```

- `results_matrix.tab` is the input file for this script.
- It should contain a `Gene ID` column (or equivalent annotation column) and columns for binned coverage values.
- The script automatically skips the first 8 metadata lines in this file.

---

### Example Input (`results_matrix.tab`)

Below is a **generalized example** showing the first 8 lines produced by deepTools, followed by the header and data table:

```
Match Type: both strands
Anchor: user-specified
Hit Locations: center
Bin Locations: physical
Bin Values: total
Bin Size: fixed
Gene List File: cfDNA_samples_reference_regions.txt
Hit File(s): ./Sample_1.singleFrag.bed

ID             ... -500:-481  ...  480:499 ...
Peak/Gene 1    ... 10         ...  15      ...
Peak/Gene 2    ... 8          ...  12      ...
```

---

## Script Configuration

At the top of the script, set the 1 kb window by specifying start and end column headers from your `results_matrix.tab`:

```python
start_column_name = "<START_COLUMN>"  # e.g., "-500:-481"
end_column_name   = "<END_COLUMN>"    # e.g., "480:499"
output_file_name  = "Count_Matrix.txt"
```

- The column names must exactly match those in the `results_matrix.tab`.

---

## Output

- A **tab-delimited count matrix** where:
  - Rows = `ID`s
  - Columns = sample names (derived from file names)
  - Values = summed counts across the 1 kb window

### Example Output
```
ID              Sample_1   Sample_2   Sample_3
Peak/Gene 1      100       120       90
Peak/Gene 2      80        95        100
```

This output can be **directly used as input** for:
- [SARTools](https://github.com/PF2-pasteur-fr/SARTools) (DESeq2) / (EdgeR)
- [edgeR](https://bioconductor.org/packages/release/bioc/html/edgeR.html)

---

## How to Run

Place the script and your deepTools output (`results_matrix.tab`) in the same directory, then run:

```bash
python Heatmap_summary_to_SARToolsCountFile_1kbWindow.py
```

Output will be saved as:
```
Count_Matrix.txt
```

---

## Requirements

- Python 3.x
- pandas

Install requirements:

```bash
pip install -r requirements.txt
```

---

## Citation

If you use this script in your research, please cite deepTools for data generation and DESeq2/edgeR for analysis.

---

## Author
Created by **Sakuntha Devaka Gunarathna**  
Published: August 1, 2025
